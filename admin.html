<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© | El Jasus</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
    <link rel="icon" type="image/png" href="ElJasus2.png">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root{--primary:#00f2ff;--secondary:#7c30ff;--bg:#0a0e1a;}
        *{box-sizing:border-box;}
        body{font-family:'Cairo',sans-serif;background:var(--bg);color:#fff;min-height:100vh;display:flex;overflow:hidden;}
        /* Sidebar */
        #admin-sidebar{width:220px;flex-shrink:0;background:linear-gradient(180deg,rgba(15,20,35,.98),rgba(10,14,26,.98));
            border-left:2px solid rgba(0,242,255,.15);display:flex;flex-direction:column;padding:20px 0;
            overflow-y:auto;}
        .admin-logo{padding:0 20px 24px;border-bottom:1px solid rgba(255,255,255,.07);}
        .admin-logo h1{font-family:'Orbitron',sans-serif;font-size:14px;font-weight:900;color:#00f2ff;letter-spacing:2px;}
        .admin-logo p{font-size:10px;color:#444;margin-top:2px;}
        .nav-section{padding:16px 20px 4px;font-size:9px;font-weight:900;text-transform:uppercase;letter-spacing:3px;color:#333;}
        .nav-item{display:flex;align-items:center;gap:10px;padding:10px 20px;font-size:12px;font-weight:700;
            color:#888;cursor:pointer;transition:all .2s;border-right:3px solid transparent;}
        .nav-item:hover{color:#ccc;background:rgba(255,255,255,.04);}
        .nav-item.active{color:#00f2ff;background:rgba(0,242,255,.08);border-right-color:#00f2ff;}
        .nav-item i{width:18px;text-align:center;font-size:14px;}
        /* Main content */
        #admin-main{flex:1;overflow-y:auto;padding:24px;}
        /* Cards */
        .glass{background:linear-gradient(135deg,rgba(15,20,35,.9),rgba(25,30,50,.8));
            border:2px solid rgba(0,242,255,.15);border-radius:16px;
            box-shadow:0 4px 20px rgba(0,0,0,.4);}
        .kpi-card{padding:20px;transition:all .3s;}
        .kpi-card:hover{border-color:rgba(0,242,255,.4);transform:translateY(-2px);}
        .kpi-num{font-family:'Orbitron',sans-serif;font-size:2rem;font-weight:900;}
        /* Tables */
        table{width:100%;border-collapse:collapse;}
        thead tr{border-bottom:2px solid rgba(0,242,255,.15);}
        th{padding:10px 12px;text-align:right;font-size:11px;font-weight:900;text-transform:uppercase;
            letter-spacing:1px;color:#666;}
        tbody tr{border-bottom:1px solid rgba(255,255,255,.04);transition:background .2s;}
        tbody tr:hover{background:rgba(255,255,255,.03);}
        td{padding:10px 12px;font-size:13px;}
        /* Badges */
        .badge{padding:3px 10px;border-radius:20px;font-size:10px;font-weight:900;}
        .badge-pending{background:rgba(251,191,36,.15);color:#fbbf24;border:1px solid rgba(251,191,36,.3);}
        .badge-resolved{background:rgba(34,197,94,.15);color:#22c55e;border:1px solid rgba(34,197,94,.3);}
        .badge-banned{background:rgba(239,68,68,.15);color:#ef4444;border:1px solid rgba(239,68,68,.3);}
        .badge-active{background:rgba(0,242,255,.15);color:#00f2ff;border:1px solid rgba(0,242,255,.3);}
        /* Input */
        .admin-input{background:rgba(255,255,255,.05);border:2px solid rgba(0,242,255,.2);
            border-radius:10px;padding:10px 14px;color:#fff;font-family:'Cairo',sans-serif;
            font-size:13px;outline:none;transition:border .2s;width:100%;}
        .admin-input:focus{border-color:rgba(0,242,255,.5);}
        textarea.admin-input{resize:vertical;min-height:80px;}
        /* Buttons */
        .btn-primary{padding:10px 20px;border-radius:10px;font-weight:900;font-size:12px;cursor:pointer;
            border:none;background:linear-gradient(135deg,#00f2ff,#7c30ff);color:white;transition:all .2s;}
        .btn-primary:hover{opacity:.9;transform:scale(1.02);}
        .btn-danger{padding:8px 16px;border-radius:8px;font-weight:900;font-size:11px;cursor:pointer;
            border:2px solid rgba(239,68,68,.4);background:rgba(239,68,68,.15);color:#ef4444;transition:all .2s;}
        .btn-danger:hover{background:rgba(239,68,68,.3);}
        .btn-success{padding:8px 16px;border-radius:8px;font-weight:900;font-size:11px;cursor:pointer;
            border:2px solid rgba(34,197,94,.4);background:rgba(34,197,94,.15);color:#22c55e;transition:all .2s;}
        .btn-sm{padding:6px 12px;border-radius:8px;font-weight:900;font-size:11px;cursor:pointer;
            border:2px solid rgba(255,255,255,.1);background:rgba(255,255,255,.06);color:#ccc;}
        /* Sections */
        .section{display:none;}
        .section.active{display:block;}
        canvas{max-height:220px;}
        /* Word category tag */
        .word-tag{display:inline-flex;align-items:center;gap:6px;padding:4px 12px;
            border-radius:20px;background:rgba(0,242,255,.1);border:1px solid rgba(0,242,255,.25);
            font-size:12px;font-weight:700;margin:3px;}
        .word-tag button{background:none;border:none;color:#ef4444;cursor:pointer;font-size:12px;padding:0;}
        /* Announcement priority */
        .ann-info{border-left:4px solid #3b82f6;}
        .ann-warning{border-left:4px solid #f59e0b;}
        .ann-critical{border-left:4px solid #ef4444;}
        /* Scrollbars */
        ::-webkit-scrollbar{width:4px;}
        ::-webkit-scrollbar-track{background:transparent;}
        ::-webkit-scrollbar-thumb{background:rgba(0,242,255,.2);border-radius:2px;}
    </style>
</head>
<body>

<!-- SIDEBAR -->
<nav id="admin-sidebar">
    <div class="admin-logo">
        <h1>EL JASUS</h1>
        <p>ADMIN PANEL</p>
    </div>

    <div class="nav-section">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</div>
    <div class="nav-item active" onclick="showSection('overview')"><i class="fas fa-tachometer-alt"></i> Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</div>
    <div class="nav-item" onclick="showSection('analytics')"><i class="fas fa-chart-line"></i> Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª</div>

    <div class="nav-section">Ø§Ù„Ø¥Ø´Ø±Ø§Ù</div>
    <div class="nav-item" onclick="showSection('reports')"><i class="fas fa-flag"></i> Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª <span id="report-badge" style="margin-right:auto;background:#ef4444;color:white;font-size:9px;padding:2px 7px;border-radius:10px;display:none;">0</span></div>
    <div class="nav-item" onclick="showSection('bans')"><i class="fas fa-ban"></i> Ø§Ù„Ø­Ø¸Ø±</div>
    <div class="nav-item" onclick="showSection('players')"><i class="fas fa-users"></i> Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ†</div>

    <div class="nav-section">Ø§Ù„Ù…Ø­ØªÙˆÙ‰</div>
    <div class="nav-item" onclick="showSection('words')"><i class="fas fa-list"></i> Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„ÙƒÙ„Ù…Ø§Øª</div>
    <div class="nav-item" onclick="showSection('announcements')"><i class="fas fa-bullhorn"></i> Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</div>

    <div class="nav-section">Ø§Ù„Ø£Ù…Ø§Ù†</div>
    <div class="nav-item" onclick="showSection('admin-access')"><i class="fas fa-user-shield"></i> ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</div>

    <div style="flex:1;"></div>
    <div style="padding:16px 20px;border-top:1px solid rgba(255,255,255,.05);">
        <a href="index.html" style="font-size:12px;color:#555;text-decoration:none;">â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¹Ø¨Ø©</a>
    </div>
</nav>

<!-- MAIN -->
<main id="admin-main">

    <!-- â”€â”€ OVERVIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <section id="section-overview" class="section active">
        <div class="flex items-center justify-between mb-6">
            <div>
                <h2 style="font-family:'Orbitron',sans-serif;font-size:20px;font-weight:900;color:#00f2ff;">Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</h2>
                <p style="font-size:12px;color:#555;" id="overview-date"></p>
            </div>
            <button class="btn-primary" onclick="refreshAll()"><i class="fas fa-sync-alt ml-2"></i>ØªØ­Ø¯ÙŠØ«</button>
        </div>

        <!-- KPI Row -->
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            <div class="glass kpi-card"><p style="font-size:10px;color:#666;text-transform:uppercase;font-weight:900;letter-spacing:1px;margin-bottom:8px;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</p><p id="kpi-players" class="kpi-num text-cyan-400">-</p></div>
            <div class="glass kpi-card"><p style="font-size:10px;color:#666;text-transform:uppercase;font-weight:900;letter-spacing:1px;margin-bottom:8px;">ØºØ±Ù Ù†Ø´Ø·Ø©</p><p id="kpi-rooms" class="kpi-num text-green-400">-</p></div>
            <div class="glass kpi-card"><p style="font-size:10px;color:#666;text-transform:uppercase;font-weight:900;letter-spacing:1px;margin-bottom:8px;">Ø¨Ù„Ø§ØºØ§Øª Ù…Ø¹Ù„Ù‚Ø©</p><p id="kpi-reports" class="kpi-num text-red-400">-</p></div>
            <div class="glass kpi-card"><p style="font-size:10px;color:#666;text-transform:uppercase;font-weight:900;letter-spacing:1px;margin-bottom:8px;">Ù„Ø§Ø¹Ø¨ÙˆÙ† Ù…Ø­Ø¸ÙˆØ±ÙˆÙ†</p><p id="kpi-bans" class="kpi-num text-orange-400">-</p></div>
        </div>

        <!-- Rank distribution + Recent activity -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="glass" style="padding:20px;">
                <h3 style="font-size:14px;font-weight:900;margin-bottom:16px;">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø±ØªØ¨</h3>
                <canvas id="rank-dist-chart"></canvas>
            </div>
            <div class="glass" style="padding:20px;">
                <h3 style="font-size:14px;font-weight:900;margin-bottom:16px;">Ø£Ø­Ø¯Ø« Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</h3>
                <div id="recent-players-list" style="font-size:12px;"></div>
            </div>
        </div>
    </section>

    <!-- â”€â”€ ANALYTICS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <section id="section-analytics" class="section">
        <h2 style="font-family:'Orbitron',sans-serif;font-size:20px;font-weight:900;color:#00f2ff;margin-bottom:24px;">Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª</h2>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <div class="glass" style="padding:20px;">
                <h3 style="font-size:14px;font-weight:900;margin-bottom:16px;">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø©</h3>
                <canvas id="category-chart"></canvas>
            </div>
            <div class="glass" style="padding:20px;">
                <h3 style="font-size:14px;font-weight:900;margin-bottom:16px;">Ø£ÙƒØ«Ø± Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ø³ØªØ®Ø¯Ø§Ù…Ø§Ù‹</h3>
                <div id="top-words-list"></div>
            </div>
        </div>
        <div class="glass" style="padding:20px;">
            <h3 style="font-size:14px;font-weight:900;margin-bottom:16px;">Ø£ÙØ¶Ù„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† â€” Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª</h3>
            <table><thead><tr><th>#</th><th>Ø§Ù„Ù„Ø§Ø¹Ø¨</th><th>Ø§Ù„Ø±ØªØ¨Ø©</th><th>Ø§Ù„Ù†Ù‚Ø§Ø·</th><th>Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª</th><th>Ù†Ø³Ø¨Ø© Ø§Ù„ÙÙˆØ²</th></tr></thead>
            <tbody id="top-players-table"></tbody></table>
        </div>
    </section>

    <!-- â”€â”€ REPORTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <section id="section-reports" class="section">
        <h2 style="font-family:'Orbitron',sans-serif;font-size:20px;font-weight:900;color:#ef4444;margin-bottom:24px;">Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª</h2>
        <div class="flex gap-3 mb-4 flex-wrap">
            <button class="btn-sm active-filter" onclick="filterReports('all',this)">Ø§Ù„ÙƒÙ„</button>
            <button class="btn-sm" onclick="filterReports('pending',this)">Ù…Ø¹Ù„Ù‚Ø©</button>
            <button class="btn-sm" onclick="filterReports('resolved',this)">Ù…Ø­Ù„ÙˆÙ„Ø©</button>
        </div>
        <div class="glass" style="padding:20px;">
            <table><thead><tr><th>Ø§Ù„Ù…ÙØ¨Ù„ÙÙ‘Øº Ø¹Ù†Ù‡</th><th>Ø§Ù„Ø³Ø¨Ø¨</th><th>Ù…Ù†</th><th>Ø§Ù„ØºØ±ÙØ©</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead>
            <tbody id="reports-table"><tr><td colspan="7" style="text-align:center;padding:30px;color:#555;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr></tbody></table>
        </div>
    </section>

    <!-- â”€â”€ BANS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <section id="section-bans" class="section">
        <h2 style="font-family:'Orbitron',sans-serif;font-size:20px;font-weight:900;color:#f97316;margin-bottom:24px;">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¸Ø±</h2>

        <!-- Ban form -->
        <div class="glass" style="padding:20px;margin-bottom:20px;">
            <h3 style="font-size:14px;font-weight:900;margin-bottom:16px;color:#f97316;">Ø­Ø¸Ø± Ù„Ø§Ø¹Ø¨ Ø¬Ø¯ÙŠØ¯</h3>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 mb-4">
                <div>
                    <label style="font-size:11px;color:#666;font-weight:700;display:block;margin-bottom:6px;">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                    <input id="ban-username" class="admin-input" type="text" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
                </div>
                <div>
                    <label style="font-size:11px;color:#666;font-weight:700;display:block;margin-bottom:6px;">Ù…Ø¯Ø© Ø§Ù„Ø­Ø¸Ø±</label>
                    <select id="ban-duration" class="admin-input">
                        <option value="86400000">24 Ø³Ø§Ø¹Ø©</option>
                        <option value="604800000">Ø£Ø³Ø¨ÙˆØ¹</option>
                        <option value="2592000000">Ø´Ù‡Ø±</option>
                        <option value="-1">Ø¯Ø§Ø¦Ù…</option>
                    </select>
                </div>
                <div>
                    <label style="font-size:11px;color:#666;font-weight:700;display:block;margin-bottom:6px;">Ø§Ù„Ø³Ø¨Ø¨</label>
                    <input id="ban-reason" class="admin-input" type="text" placeholder="Ø³Ø¨Ø¨ Ø§Ù„Ø­Ø¸Ø±">
                </div>
            </div>
            <button class="btn-danger" onclick="banPlayer()">
                <i class="fas fa-ban ml-2"></i>ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ø¸Ø±
            </button>
        </div>

        <!-- Active bans -->
        <div class="glass" style="padding:20px;">
            <h3 style="font-size:14px;font-weight:900;margin-bottom:16px;">Ø§Ù„Ø­Ø¸ÙˆØ±Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©</h3>
            <table><thead><tr><th>Ø§Ù„Ù„Ø§Ø¹Ø¨</th><th>Ø§Ù„Ø³Ø¨Ø¨</th><th>ÙŠÙ†ØªÙ‡ÙŠ</th><th>Ø­ÙØ¸Ø± Ø¨ÙˆØ§Ø³Ø·Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead>
            <tbody id="bans-table"><tr><td colspan="5" style="text-align:center;padding:30px;color:#555;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr></tbody></table>
        </div>
    </section>

    <!-- â”€â”€ PLAYERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <section id="section-players" class="section">
        <h2 style="font-family:'Orbitron',sans-serif;font-size:20px;font-weight:900;color:#00f2ff;margin-bottom:24px;">Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ†</h2>
        <div class="flex gap-3 mb-4">
            <input id="player-search" class="admin-input" type="text" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù„Ø§Ø¹Ø¨..." style="max-width:300px;" oninput="searchPlayers(this.value)">
        </div>
        <div class="glass" style="padding:20px;">
            <table><thead><tr><th>Ø§Ù„Ù„Ø§Ø¹Ø¨</th><th>Ø§Ù„Ø±ØªØ¨Ø©</th><th>Ø§Ù„Ù†Ù‚Ø§Ø·</th><th>Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª</th><th>Ø§Ù„Ø¹Ù…Ù„Ø§Øª</th><th>Ø¢Ø®Ø± Ù†Ø´Ø§Ø·</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead>
            <tbody id="players-table"><tr><td colspan="7" style="text-align:center;padding:30px;color:#555;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr></tbody></table>
        </div>
    </section>

    <!-- â”€â”€ WORDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <section id="section-words" class="section">
        <h2 style="font-family:'Orbitron',sans-serif;font-size:20px;font-weight:900;color:#a855f7;margin-bottom:24px;">Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„ÙƒÙ„Ù…Ø§Øª</h2>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Category selector -->
            <div class="glass" style="padding:20px;">
                <h3 style="font-size:14px;font-weight:900;margin-bottom:16px;">Ø§Ù„ÙØ¦Ø§Øª</h3>
                <div id="category-list" style="space-y:8px;"></div>
                <hr style="border:none;border-top:1px solid rgba(255,255,255,.07);margin:16px 0;">
                <div>
                    <label style="font-size:11px;color:#666;font-weight:700;display:block;margin-bottom:6px;">ÙØ¦Ø© Ø¬Ø¯ÙŠØ¯Ø©</label>
                    <input id="new-category" class="admin-input" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„ÙØ¦Ø©">
                    <button class="btn-primary" style="margin-top:10px;width:100%;" onclick="addCategory()">Ø¥Ø¶Ø§ÙØ© ÙØ¦Ø©</button>
                </div>
            </div>

            <!-- Words in category -->
            <div class="glass lg:col-span-2" style="padding:20px;">
                <div class="flex items-center justify-between mb-4">
                    <h3 style="font-size:14px;font-weight:900;">ÙƒÙ„Ù…Ø§Øª Ø§Ù„ÙØ¦Ø©: <span id="active-cat-name" style="color:#a855f7;">â€”</span></h3>
                    <span id="word-count" style="font-size:11px;color:#666;"></span>
                </div>
                <div id="words-cloud" style="min-height:100px;margin-bottom:16px;"></div>
                <div class="flex gap-3">
                    <input id="new-word" class="admin-input" type="text" placeholder="ÙƒÙ„Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©">
                    <button class="btn-primary" onclick="addWord()" style="white-space:nowrap;">+ Ø¥Ø¶Ø§ÙØ©</button>
                </div>
            </div>
        </div>
    </section>

    <!-- â”€â”€ ANNOUNCEMENTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <section id="section-announcements" class="section">
        <h2 style="font-family:'Orbitron',sans-serif;font-size:20px;font-weight:900;color:#00f2ff;margin-bottom:24px;">Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</h2>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Create announcement -->
            <div class="glass" style="padding:20px;">
                <h3 style="font-size:14px;font-weight:900;margin-bottom:16px;">Ø¥Ø¹Ù„Ø§Ù† Ø¬Ø¯ÙŠØ¯</h3>
                <div class="mb-4">
                    <label style="font-size:11px;color:#666;font-weight:700;display:block;margin-bottom:6px;">Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</label>
                    <div class="flex gap-3">
                        <button class="btn-sm" id="pri-info" onclick="setPriority('info',this)" style="border-color:rgba(59,130,246,.4);color:#3b82f6;">â„¹ï¸ Ù…Ø¹Ù„ÙˆÙ…Ø©</button>
                        <button class="btn-sm" id="pri-warning" onclick="setPriority('warning',this)" style="border-color:rgba(245,158,11,.4);color:#f59e0b;">âš ï¸ ØªØ­Ø°ÙŠØ±</button>
                        <button class="btn-sm" id="pri-critical" onclick="setPriority('critical',this)" style="border-color:rgba(239,68,68,.4);color:#ef4444;">ğŸš¨ Ø·Ø§Ø±Ø¦</button>
                    </div>
                </div>
                <div class="mb-4">
                    <label style="font-size:11px;color:#666;font-weight:700;display:block;margin-bottom:6px;">Ù†Øµ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</label>
                    <textarea id="ann-text" class="admin-input" placeholder="Ø§ÙƒØªØ¨ Ø¥Ø¹Ù„Ø§Ù†Ùƒ Ù‡Ù†Ø§..."></textarea>
                </div>
                <div class="mb-4">
                    <label style="font-size:11px;color:#666;font-weight:700;display:block;margin-bottom:6px;">Ù…Ø¯Ø© Ø§Ù„Ø¸Ù‡ÙˆØ±</label>
                    <select id="ann-duration" class="admin-input">
                        <option value="3600000">Ø³Ø§Ø¹Ø©</option>
                        <option value="21600000">6 Ø³Ø§Ø¹Ø§Øª</option>
                        <option value="86400000" selected>24 Ø³Ø§Ø¹Ø©</option>
                        <option value="604800000">Ø£Ø³Ø¨ÙˆØ¹</option>
                    </select>
                </div>
                <button class="btn-primary w-full" onclick="sendAnnouncement()">
                    <i class="fas fa-bullhorn ml-2"></i>Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†
                </button>
            </div>

            <!-- Active announcements -->
            <div class="glass" style="padding:20px;">
                <h3 style="font-size:14px;font-weight:900;margin-bottom:16px;">Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©</h3>
                <div id="active-announcements" style="space-y:10px;"></div>
            </div>
        </div>
    </section>


    <!-- â”€â”€ ADMIN ACCESS MANAGEMENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <section id="section-admin-access" class="section">
        <h2 style="font-family:'Orbitron',sans-serif;font-size:20px;font-weight:900;color:#00f2ff;margin-bottom:24px;">Ø¥Ø¯Ø§Ø±Ø© ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Admin code info -->
            <div class="glass" style="padding:20px;">
                <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px;">
                    <div style="width:48px;height:48px;border-radius:12px;
                        background:rgba(0,242,255,.15);border:2px solid rgba(0,242,255,.3);
                        display:flex;align-items:center;justify-content:center;">
                        <i class="fas fa-key" style="font-size:20px;color:#00f2ff;"></i>
                    </div>
                    <div>
                        <h3 style="font-size:14px;font-weight:900;color:#00f2ff;">Ø±Ù…Ø² Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠ</h3>
                        <p style="font-size:11px;color:#666;">Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ø§ Ø§Ù„Ø±Ù…Ø² Ù„Ù…Ù†Ø­ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</p>
                    </div>
                </div>
                
                <div style="background:rgba(0,242,255,.08);border:2px solid rgba(0,242,255,.2);
                    border-radius:12px;padding:16px;margin-bottom:16px;text-align:center;">
                    <p style="font-family:'Orbitron',sans-serif;font-size:24px;font-weight:900;
                        color:#00f2ff;letter-spacing:4px;" id="current-admin-code">ADMIN26</p>
                    <button onclick="copyAdminCode()" 
                        style="margin-top:12px;padding:8px 16px;border-radius:8px;
                        background:rgba(0,242,255,.15);border:2px solid rgba(0,242,255,.3);
                        color:#00f2ff;cursor:pointer;font-size:12px;font-weight:700;
                        font-family:'Cairo',sans-serif;">
                        <i class="fas fa-copy ml-1"></i> Ù†Ø³Ø® Ø§Ù„Ø±Ù…Ø²
                    </button>
                </div>
                
                <div style="background:rgba(251,191,36,.08);border-left:4px solid #fbbf24;
                    padding:12px;border-radius:8px;margin-bottom:16px;">
                    <p style="font-size:12px;color:#fbbf24;line-height:1.6;">
                        <i class="fas fa-exclamation-triangle ml-1"></i>
                        <strong>ØªÙ†Ø¨ÙŠÙ‡ Ø£Ù…Ù†ÙŠ:</strong><br>
                        Ù„Ø§ ØªØ´Ø§Ø±Ùƒ Ù‡Ø°Ø§ Ø§Ù„Ø±Ù…Ø² Ø¥Ù„Ø§ Ù…Ø¹ Ù…Ù† ØªØ«Ù‚ Ø¨Ù‡Ù…. Ø£ÙŠ Ø´Ø®Øµ Ù„Ø¯ÙŠÙ‡ Ù‡Ø°Ø§ Ø§Ù„Ø±Ù…Ø² Ø³ÙŠØ­ØµÙ„ Ø¹Ù„Ù‰ ØµÙ„Ø§Ø­ÙŠØ§Øª ÙƒØ§Ù…Ù„Ø©.
                    </p>
                </div>
                
                <button onclick="generateNewCode()" class="btn-primary" style="width:100%;">
                    <i class="fas fa-sync-alt ml-2"></i>
                    Ø¥Ù†Ø´Ø§Ø¡ Ø±Ù…Ø² Ø¬Ø¯ÙŠØ¯
                </button>
            </div>

            <!-- Current admins list -->
            <div class="glass" style="padding:20px;">
                <h3 style="font-size:14px;font-weight:900;margin-bottom:16px;">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙˆÙ† Ø§Ù„Ø­Ø§Ù„ÙŠÙˆÙ†</h3>
                
                <div id="admins-list" style="max-height:400px;overflow-y:auto;">
                    <p style="color:#555;font-size:12px;text-align:center;padding:20px;">
                        Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...
                    </p>
                </div>
                
                <button onclick="loadAdminsList()" class="btn-sm" style="width:100%;margin-top:12px;">
                    <i class="fas fa-sync-alt ml-1"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                </button>
            </div>
        </div>
        
        <!-- Instructions -->
        <div class="glass" style="padding:20px;margin-top:20px;">
            <h3 style="font-size:14px;font-weight:900;margin-bottom:16px;color:#00f2ff;">
                <i class="fas fa-info-circle ml-2"></i>
                ÙƒÙŠÙÙŠØ© Ù…Ù†Ø­ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
            </h3>
            <ol style="padding-right:24px;color:#ccc;font-size:13px;line-height:2;">
                <li>Ø§Ù†Ø³Ø® Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø­Ø§Ù„ÙŠ Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰</li>
                <li>Ø£Ø±Ø³Ù„ Ø§Ù„Ø±Ù…Ø² Ù„Ù„Ø´Ø®Øµ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø¹Ø¨Ø± ÙˆØ³ÙŠÙ„Ø© Ø¢Ù…Ù†Ø©</li>
                <li>Ø§Ø·Ù„Ø¨ Ù…Ù†Ù‡ ÙØªØ­ ØµÙØ­Ø© <code style="background:rgba(0,242,255,.1);padding:2px 8px;border-radius:4px;color:#00f2ff;">admin.html</code></li>
                <li>Ø³ÙŠÙØ·Ù„Ø¨ Ù…Ù†Ù‡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù…Ø² â€” Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù‚Ù‚ Ø³ÙŠØ­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</li>
                <li>ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ù†Ø´Ø§Ø¡ Ø±Ù…Ø² Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª Ù„Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø±Ù…ÙˆØ² Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©</li>
            </ol>
        </div>
    </section>

</main>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import { getDatabase, ref, get, set, update, remove, push, onValue, query, orderByChild } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

const firebaseConfig = {
    apiKey:"AIzaSyDnd-pmKEatI3DaFz6xHWB5ucurtHXt9tk",
    authDomain:"el-jasus.firebaseapp.com",
    databaseURL:"https://el-jasus-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId:"el-jasus", appId:"1:415659587906:web:782f7940176ea4097eb0db"
};

const app  = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db   = getDatabase(app);

// ADMIN ACCESS VIA CODE REDEMPTION
const ADMIN_CODE = 'ADMIN26';

let allPlayers = {};
let isAdmin = false;
let allReports = {};
let allBans    = {};
let activePriority = 'info';
let activeCategory = null;
let wordListData   = {};
let rankChart = null;
let catChart  = null;

// â”€â”€ AUTH GUARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
onAuthStateChanged(auth, async user => {
    if (!user) { window.location.href = 'login.html'; return; }
    
    // Check if user has admin access via redeemed code
    const adminSnap = await get(ref(db, `players/${user.uid}/isAdmin`));
    isAdmin = adminSnap.val() === true;
    
    if (!isAdmin) {
        // Show code redemption modal
        showAdminCodeModal();
        return;
    }
    
    // Admin verified - load dashboard
    document.getElementById('overview-date').textContent =
        new Date().toLocaleDateString('ar-SA', {weekday:'long',year:'numeric',month:'long',day:'numeric'});
    await refreshAll();
});

// â”€â”€ ADMIN CODE REDEMPTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showAdminCodeModal() {
    const modal = document.createElement('div');
    modal.id = 'admin-code-modal';
    modal.style.cssText = 'position:fixed;inset:0;z-index:9999;background:rgba(0,0,0,.95);' +
        'display:flex;align-items:center;justify-content:center;padding:20px;' +
        'backdrop-filter:blur(12px);';
    modal.innerHTML = `
        <div style="background:linear-gradient(135deg,rgba(15,20,35,.98),rgba(25,30,50,.98));
            border:2px solid rgba(0,242,255,.3);border-radius:24px;padding:40px;
            max-width:420px;width:100%;text-align:center;
            box-shadow:0 8px 32px rgba(0,0,0,.5);">
            
            <div style="width:80px;height:80px;margin:0 auto 24px;border-radius:50%;
                background:linear-gradient(135deg,rgba(0,242,255,.15),rgba(124,48,255,.15));
                border:3px solid rgba(0,242,255,.4);display:flex;align-items:center;justify-content:center;">
                <i class="fas fa-lock" style="font-size:36px;color:#00f2ff;"></i>
            </div>
            
            <h2 style="font-family:'Orbitron',sans-serif;font-size:24px;font-weight:900;
                color:#00f2ff;margin-bottom:12px;letter-spacing:2px;">
                ÙˆØµÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
            </h2>
            
            <p style="font-size:14px;color:#888;margin-bottom:32px;line-height:1.6;">
                ÙŠØªØ·Ù„Ø¨ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø±Ù…Ø² Ø®Ø§Øµ.<br>
                Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø£Ø¯Ù†Ø§Ù‡ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©.
            </p>
            
            <div style="margin-bottom:24px;">
                <input type="text" id="admin-code-input" 
                    placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©"
                    style="width:100%;padding:16px;background:rgba(255,255,255,.05);
                    border:2px solid rgba(0,242,255,.2);border-radius:12px;
                    color:white;font-family:'Orbitron',sans-serif;font-size:16px;
                    text-align:center;letter-spacing:3px;font-weight:700;
                    outline:none;transition:border .3s;"
                    onfocus="this.style.borderColor='rgba(0,242,255,.5)'"
                    onblur="this.style.borderColor='rgba(0,242,255,.2)'">
            </div>
            
            <div id="code-error" style="display:none;color:#ef4444;font-size:13px;
                font-weight:700;margin-bottom:16px;padding:12px;
                background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.3);
                border-radius:10px;">
                Ø±Ù…Ø² ØºÙŠØ± ØµØ­ÙŠØ­. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.
            </div>
            
            <div style="display:flex;gap:12px;">
                <button id="verify-code-btn" onclick="verifyAdminCode()"
                    style="flex:1;padding:14px;border-radius:12px;
                    background:linear-gradient(135deg,#00f2ff,#7c30ff);
                    border:none;color:white;font-weight:900;cursor:pointer;
                    font-family:'Cairo',sans-serif;font-size:14px;
                    transition:all .3s;">
                    <i class="fas fa-check ml-2"></i>
                    ØªØ­Ù‚Ù‚
                </button>
                <button onclick="window.location.href='index.html'"
                    style="padding:14px 24px;border-radius:12px;
                    background:rgba(255,255,255,.08);
                    border:2px solid rgba(255,255,255,.1);
                    color:#888;cursor:pointer;font-family:'Cairo',sans-serif;
                    font-weight:900;font-size:14px;">
                    Ø¥Ù„ØºØ§Ø¡
                </button>
            </div>
            
            <p style="margin-top:24px;font-size:11px;color:#444;line-height:1.5;">
                ğŸ’¡ <strong>Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±Ù…Ø² Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:</strong><br>
                ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ù…Ø·ÙˆØ± Ø§Ù„Ù„Ø¹Ø¨Ø© Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ù…Ø®ØµØµ Ù„Ùƒ
            </p>
        </div>
    `;
    document.body.appendChild(modal);
    
    // Focus input
    setTimeout(() => document.getElementById('admin-code-input').focus(), 100);
    
    // Allow Enter key to verify
    document.getElementById('admin-code-input').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') verifyAdminCode();
    });
}

window.verifyAdminCode = async function() {
    const input = document.getElementById('admin-code-input');
    const code  = input.value.trim().toUpperCase();
    const error = document.getElementById('code-error');
    const btn   = document.getElementById('verify-code-btn');
    
    if (!code) {
        error.textContent = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù…Ø²';
        error.style.display = 'block';
        return;
    }
    
    // Disable button during verification
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin ml-2"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...';
    
    // Verify code against Firebase
    const codeSnap = await get(ref(db, 'adminConfig/accessCode'));
    const validCode = codeSnap.exists() ? codeSnap.val() : ADMIN_CODE; // Fallback to ADMIN26
    
    if (code === validCode) {
        // Valid code - grant admin access
        try {
            const user = auth.currentUser;
            await set(ref(db, `players/${user.uid}/isAdmin`), true);
            await set(ref(db, `players/${user.uid}/adminSince`), Date.now());
            
            // Success animation
            error.style.display = 'none';
            btn.innerHTML = '<i class="fas fa-check ml-2"></i> ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚!';
            btn.style.background = 'linear-gradient(135deg,#22c55e,#16a34a)';
            
            setTimeout(() => {
                document.getElementById('admin-code-modal').remove();
                isAdmin = true;
                document.getElementById('overview-date').textContent =
                    new Date().toLocaleDateString('ar-SA', {weekday:'long',year:'numeric',month:'long',day:'numeric'});
                refreshAll();
            }, 1500);
            
        } catch (e) {
            error.textContent = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.';
            error.style.display = 'block';
            btn.disabled = false;
            btn.innerHTML = '<i class="fas fa-check ml-2"></i> ØªØ­Ù‚Ù‚';
        }
    } else {
        // Invalid code
        error.textContent = 'âŒ Ø±Ù…Ø² ØºÙŠØ± ØµØ­ÙŠØ­. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.';
        error.style.display = 'block';
        input.value = '';
        input.style.borderColor = '#ef4444';
        setTimeout(() => input.style.borderColor = 'rgba(0,242,255,.2)', 2000);
        
        btn.disabled = false;
        btn.innerHTML = '<i class="fas fa-check ml-2"></i> ØªØ­Ù‚Ù‚';
        
        // Shake animation
        input.style.animation = 'shake 0.5s';
        setTimeout(() => input.style.animation = '', 500);
    }
};

// Add shake animation
const style = document.createElement('style');
style.textContent = `
    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-10px); }
        75% { transform: translateX(10px); }
    }
    #verify-code-btn:hover { opacity: 0.9; transform: scale(1.02); }
    #verify-code-btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
`;
document.head.appendChild(style);

// â”€â”€ NAVIGATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.showSection = (name) => {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    document.getElementById('section-' + name).classList.add('active');
    event.currentTarget.classList.add('active');

    // Lazy load section data
    if (name === 'reports')   loadReports();
    if (name === 'bans')      loadBans();
    if (name === 'players')   loadPlayers();
    if (name === 'words')     loadWords();
    if (name === 'announcements') loadAnnouncements();
    if (name === 'analytics') loadAnalytics();
};

window.refreshAll = async () => {
    // Initialize admin code in Firebase if not exists
    const codeSnap = await get(ref(db, 'adminConfig/accessCode'));
    if (!codeSnap.exists()) {
        await set(ref(db, 'adminConfig/accessCode'), ADMIN_CODE);
        await set(ref(db, 'adminConfig/codeCreatedAt'), Date.now());
    }

    const [playerSnap, roomSnap, reportSnap, banSnap] = await Promise.all([
        get(ref(db, 'players')),
        get(ref(db, 'rooms')),
        get(ref(db, 'reports')),
        get(ref(db, 'bans'))
    ]);

    allPlayers = playerSnap.exists() ? playerSnap.val() : {};
    allReports = reportSnap.exists() ? reportSnap.val() : {};
    allBans    = banSnap.exists() ? banSnap.val() : {};

    const playerCount = Object.keys(allPlayers).length;
    const roomCount   = roomSnap.exists() ? Object.values(roomSnap.val()).filter(r => r.status === 'waiting' || r.status === 'playing').length : 0;
    const pendingReps = Object.values(allReports).filter(r => r.status === 'pending').length;
    const activeBans  = Object.keys(allBans).length;

    document.getElementById('kpi-players').textContent = playerCount;
    document.getElementById('kpi-rooms').textContent   = roomCount;
    document.getElementById('kpi-reports').textContent = pendingReps;
    document.getElementById('kpi-bans').textContent    = activeBans;

    // Report badge
    const badge = document.getElementById('report-badge');
    badge.textContent = pendingReps;
    badge.style.display = pendingReps > 0 ? 'inline-block' : 'none';

    renderRankDist();
    renderRecentPlayers();
};

// â”€â”€ RANK DISTRIBUTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderRankDist() {
    const counts = {Bronze:0, Silver:0, Gold:0, Platinum:0, Diamond:0};
    Object.values(allPlayers).forEach(p => { if (counts[p.rank] !== undefined) counts[p.rank]++; else counts.Bronze++; });
    if (rankChart) rankChart.destroy();
    rankChart = new Chart(document.getElementById('rank-dist-chart'), {
        type: 'doughnut',
        data: { labels: Object.keys(counts), datasets:[{
            data: Object.values(counts),
            backgroundColor: ['#cd7f32','#c0c0c0','#ffd700','#e5e4e2','#00f2ff'],
            borderColor: 'transparent', hoverOffset: 6
        }]},
        options: { plugins:{ legend:{ position:'right', labels:{ color:'#aaa', font:{family:'Cairo'} } } }, cutout:'65%', responsive:true }
    });
}

// â”€â”€ RECENT PLAYERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderRecentPlayers() {
    const sorted = Object.values(allPlayers)
        .filter(p => p.username && p.stats?.lastPlayed)
        .sort((a,b) => (b.stats.lastPlayed||0) - (a.stats.lastPlayed||0))
        .slice(0, 8);

    document.getElementById('recent-players-list').innerHTML = sorted.map(p => `
        <div style="display:flex;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px solid rgba(255,255,255,.05);">
            <div style="display:flex;align-items:center;gap:10px;">
                <div style="width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,#00f2ff,#7c30ff);display:flex;align-items:center;justify-content:center;font-size:12px;">
                    <i class="fas fa-user" style="color:white;"></i>
                </div>
                <div>
                    <p style="font-size:12px;font-weight:700;">${p.username}</p>
                    <p style="font-size:10px;color:#555;">${new Date(p.stats.lastPlayed).toLocaleDateString('ar-SA')}</p>
                </div>
            </div>
            <span style="font-size:11px;font-weight:900;color:#00f2ff;">${p.rank || 'Bronze'}</span>
        </div>`).join('') || '<p style="color:#555;font-size:12px;text-align:center;padding:20px;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„Ø§Ø¹Ø¨ÙˆÙ†</p>';
}

// â”€â”€ ANALYTICS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function loadAnalytics() {
    // Category distribution
    const catCounts = {};
    Object.values(allPlayers).forEach(p => {
        if (p.categoryStats) {
            Object.entries(p.categoryStats).forEach(([cat,cnt]) => {
                catCounts[cat] = (catCounts[cat]||0) + cnt;
            });
        }
    });
    const cats = Object.entries(catCounts).sort((a,b)=>b[1]-a[1]).slice(0,8);
    if (catChart) catChart.destroy();
    catChart = new Chart(document.getElementById('category-chart'), {
        type:'bar',
        data:{ labels: cats.map(c=>c[0]), datasets:[{ label:'Ù…Ø¨Ø§Ø±ÙŠØ§Øª', data: cats.map(c=>c[1]),
            backgroundColor:'rgba(0,242,255,.3)', borderColor:'#00f2ff', borderWidth:2, borderRadius:6 }]},
        options:{ plugins:{legend:{display:false}},
            scales:{ x:{ticks:{color:'#aaa',font:{family:'Cairo'}}}, y:{ticks:{color:'#aaa'}} },
            responsive:true }
    });

    // Top players
    const topPlayers = Object.values(allPlayers)
        .filter(p=>p.username)
        .sort((a,b)=>(b.rankPoints||0)-(a.rankPoints||0))
        .slice(0,20);

    document.getElementById('top-players-table').innerHTML = topPlayers.map((p,i)=>{
        const total = p.stats?.totalGames||0;
        const wins  = (p.stats?.spyWins||0) + (p.stats?.innocentWins||0);
        const wr    = total ? Math.round(wins/total*100) : 0;
        return `<tr><td style="color:#555;">${i+1}</td>
            <td style="font-weight:700;">${p.username}</td>
            <td><span class="badge badge-active">${p.rank||'Bronze'}</span></td>
            <td style="font-family:'Orbitron',sans-serif;color:#00f2ff;font-size:12px;">${p.rankPoints||0}</td>
            <td>${total}</td>
            <td style="color:${wr>=50?'#22c55e':'#ef4444'};">${wr}%</td></tr>`;
    }).join('');
}

// â”€â”€ REPORTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let currentReportFilter = 'all';
function loadReports() {
    get(ref(db,'reports')).then(snap => {
        allReports = snap.exists() ? snap.val() : {};
        renderReports();
    });
}

function renderReports() {
    const tbody = document.getElementById('reports-table');
    let reports = Object.entries(allReports);
    if (currentReportFilter !== 'all') reports = reports.filter(([,r]) => r.status === currentReportFilter);
    reports.sort((a,b) => (b[1].timestamp||0) - (a[1].timestamp||0));

    if (!reports.length) { tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;padding:30px;color:#555;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ù„Ø§ØºØ§Øª</td></tr>'; return; }

    tbody.innerHTML = reports.map(([id,r]) => `
        <tr>
            <td style="font-weight:700;">${r.reportedUsername || 'â€”'}</td>
            <td>${reasonAr(r.reason)}</td>
            <td style="color:#888;font-size:11px;">${r.reportedByUsername||'â€”'}</td>
            <td style="font-family:'Orbitron',sans-serif;font-size:11px;color:#555;">${r.roomCode||'â€”'}</td>
            <td style="font-size:11px;color:#555;">${r.timestamp ? new Date(r.timestamp).toLocaleDateString('ar-SA') : 'â€”'}</td>
            <td><span class="badge ${r.status==='pending'?'badge-pending':'badge-resolved'}">${r.status==='pending'?'Ù…Ø¹Ù„Ù‚':'Ù…Ø­Ù„ÙˆÙ„'}</span></td>
            <td>
                <div style="display:flex;gap:6px;">
                    <button class="btn-danger" onclick="resolveReport('${id}')">Ø­Ù„</button>
                    <button class="btn-sm" onclick="banFromReport('${r.reportedUsername}')">Ø­Ø¸Ø±</button>
                </div>
            </td>
        </tr>`).join('');
}

window.filterReports = (f, btn) => {
    currentReportFilter = f;
    document.querySelectorAll('.active-filter').forEach(b => { b.classList.remove('active-filter'); b.style.background=''; });
    btn.classList.add('active-filter'); btn.style.background='rgba(0,242,255,.15)';
    renderReports();
};

window.resolveReport = async (id) => {
    await update(ref(db, `reports/${id}`), { status:'resolved', resolvedAt: Date.now() });
    loadReports();
};

window.banFromReport = (username) => {
    document.getElementById('ban-username').value = username || '';
    showSection('bans');
};

function reasonAr(r) {
    const m = {cheating:'ØºØ´',spam:'Ø³Ø¨Ø§Ù…',harassment:'ØªØ­Ø±Ø´',offensive:'Ù…Ø­ØªÙˆÙ‰ Ù…Ø³ÙŠØ¡',other:'Ø£Ø®Ø±Ù‰'};
    return m[r] || r || 'â€”';
}

// â”€â”€ BAN MANAGEMENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function loadBans() {
    get(ref(db,'bans')).then(snap => {
        allBans = snap.exists() ? snap.val() : {};
        renderBans();
    });
}

function renderBans() {
    const tbody = document.getElementById('bans-table');
    const bans  = Object.entries(allBans);
    if (!bans.length) { tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;padding:30px;color:#555;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¸ÙˆØ±Ø§Øª</td></tr>'; return; }

    tbody.innerHTML = bans.map(([uid,ban]) => `
        <tr>
            <td style="font-weight:700;">${ban.username || uid.slice(0,12)}</td>
            <td>${ban.reason || 'â€”'}</td>
            <td style="font-size:11px;color:${ban.permanent?'#ef4444':'#aaa'};">${ban.permanent ? 'ğŸ”´ Ø¯Ø§Ø¦Ù…' : new Date(ban.expiresAt).toLocaleDateString('ar-SA')}</td>
            <td style="font-size:11px;color:#555;">${ban.bannedByName || 'Admin'}</td>
            <td><button class="btn-success" onclick="unban('${uid}')">Ø±ÙØ¹ Ø§Ù„Ø­Ø¸Ø±</button></td>
        </tr>`).join('');
}

window.banPlayer = async () => {
    const username = document.getElementById('ban-username').value.trim();
    const reason   = document.getElementById('ban-reason').value.trim();
    const duration = parseInt(document.getElementById('ban-duration').value);
    if (!username) { alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…'); return; }

    // Find player UID
    const snap = await get(ref(db,'players'));
    if (!snap.exists()) return;
    const players = snap.val();
    let targetUid = null;
    for (const uid in players) {
        if (players[uid].username === username) { targetUid = uid; break; }
    }

    if (!targetUid) { alert('Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯'); return; }

    await set(ref(db, `bans/${targetUid}`), {
        username,
        reason: reason || 'Ù…Ø®Ø§Ù„ÙØ© Ø§Ù„Ù„ÙˆØ§Ø¦Ø­',
        bannedAt:  Date.now(),
        expiresAt: duration === -1 ? null : Date.now() + duration,
        permanent: duration === -1,
        bannedByName: 'Admin'
    });

    alert(`ØªÙ… Ø­Ø¸Ø± ${username}`);
    document.getElementById('ban-username').value = '';
    document.getElementById('ban-reason').value = '';
    loadBans();
};

window.unban = async (uid) => {
    if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ÙØ¹ Ø§Ù„Ø­Ø¸Ø±ØŸ')) return;
    await remove(ref(db, `bans/${uid}`));
    loadBans();
};

// â”€â”€ PLAYERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let filteredPlayers = [];
function loadPlayers() {
    filteredPlayers = Object.values(allPlayers).filter(p => p.username);
    renderPlayersTable(filteredPlayers);
}

window.searchPlayers = (q) => {
    const results = filteredPlayers.filter(p => p.username?.toLowerCase().includes(q.toLowerCase()));
    renderPlayersTable(results);
};

function renderPlayersTable(players) {
    const tbody = document.getElementById('players-table');
    if (!players.length) { tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;padding:30px;color:#555;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„Ø§Ø¹Ø¨ÙˆÙ†</td></tr>'; return; }
    const RANK_COLORS = {Diamond:'#00f2ff',Platinum:'#e5e4e2',Gold:'#ffd700',Silver:'#c0c0c0',Bronze:'#cd7f32'};

    tbody.innerHTML = players.sort((a,b)=>(b.rankPoints||0)-(a.rankPoints||0)).map((p,i) => {
        const total = p.stats?.totalGames||0;
        const wins  = (p.stats?.spyWins||0)+(p.stats?.innocentWins||0);
        const wr    = total ? Math.round(wins/total*100) : 0;
        const color = RANK_COLORS[p.rank] || '#888';
        const last  = p.stats?.lastPlayed ? new Date(p.stats.lastPlayed).toLocaleDateString('ar-SA') : 'â€”';
        return `<tr>
            <td style="font-weight:700;">${p.username}</td>
            <td style="color:${color};font-weight:900;font-size:12px;">${p.rank||'Bronze'}</td>
            <td style="font-family:'Orbitron',sans-serif;font-size:11px;color:${color};">${p.rankPoints||0}</td>
            <td>${total}</td>
            <td style="color:#ffd700;font-weight:700;">ğŸª™ ${p.coins||0}</td>
            <td style="font-size:11px;color:#555;">${last}</td>
            <td>
                <div style="display:flex;gap:6px;">
                    <button class="btn-sm" onclick="viewPlayer('${p.username}')">Ø¹Ø±Ø¶</button>
                    <button class="btn-danger" onclick="document.getElementById('ban-username').value='${p.username}';showSection('bans')">Ø­Ø¸Ø±</button>
                </div>
            </td>
        </tr>`;
    }).join('');
}

window.viewPlayer = (username) => {
    const p = Object.values(allPlayers).find(pl => pl.username === username);
    if (!p) return;
    alert(JSON.stringify({
        username: p.username, rank: p.rank, points: p.rankPoints,
        totalGames: p.stats?.totalGames, spyWins: p.stats?.spyWins,
        innocentWins: p.stats?.innocentWins, coins: p.coins
    }, null, 2));
};

// â”€â”€ WORD MANAGEMENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadWords() {
    const snap = await get(ref(db, 'wordLists'));
    wordListData = snap.exists() ? snap.val() : {};
    renderCategoryList();
}

function renderCategoryList() {
    const list = document.getElementById('category-list');
    const cats  = Object.keys(wordListData);
    list.innerHTML = cats.map(cat => `
        <div style="display:flex;align-items:center;justify-content:space-between;padding:8px 12px;
            border-radius:10px;margin-bottom:4px;cursor:pointer;transition:all .2s;
            background:${activeCategory===cat?'rgba(168,85,247,.2)':'rgba(255,255,255,.04)'};"
            onclick="selectCategory('${cat}')">
            <span style="font-size:13px;font-weight:700;">${cat}</span>
            <span style="font-size:10px;color:#555;">${Array.isArray(wordListData[cat])?wordListData[cat].length:Object.keys(wordListData[cat]).length} ÙƒÙ„Ù…Ø©</span>
        </div>`).join('') || '<p style="color:#555;font-size:12px;">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ¦Ø§Øª</p>';
}

window.selectCategory = (cat) => {
    activeCategory = cat;
    document.getElementById('active-cat-name').textContent = cat;
    const words = Array.isArray(wordListData[cat]) ? wordListData[cat] : Object.keys(wordListData[cat]);
    document.getElementById('word-count').textContent = words.length + ' ÙƒÙ„Ù…Ø©';
    document.getElementById('words-cloud').innerHTML = words.map(w => `
        <span class="word-tag">${w}
            <button onclick="deleteWord('${cat}','${w}')">âœ•</button>
        </span>`).join('');
    renderCategoryList();
};

window.addWord = async () => {
    const word = document.getElementById('new-word').value.trim();
    if (!word || !activeCategory) { alert('Ø§Ø®ØªØ± ÙØ¦Ø© ÙˆØ£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø©'); return; }
    const words = Array.isArray(wordListData[activeCategory]) ? [...wordListData[activeCategory]] : Object.keys(wordListData[activeCategory]);
    if (!words.includes(word)) {
        words.push(word);
        wordListData[activeCategory] = words;
        await set(ref(db, `wordLists/${activeCategory}`), words);
        document.getElementById('new-word').value = '';
        selectCategory(activeCategory);
    } else { alert('Ù‡Ø°Ù‡ Ø§Ù„ÙƒÙ„Ù…Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¨Ø§Ù„ÙØ¹Ù„'); }
};

window.deleteWord = async (cat, word) => {
    if (!confirm(`Ø­Ø°Ù "${word}"ØŸ`)) return;
    const words = Array.isArray(wordListData[cat]) ? [...wordListData[cat]] : Object.keys(wordListData[cat]);
    const updated = words.filter(w => w !== word);
    wordListData[cat] = updated;
    await set(ref(db, `wordLists/${cat}`), updated);
    selectCategory(cat);
};

window.addCategory = async () => {
    const cat = document.getElementById('new-category').value.trim();
    if (!cat) return;
    if (wordListData[cat]) { alert('Ù‡Ø°Ù‡ Ø§Ù„ÙØ¦Ø© Ù…ÙˆØ¬ÙˆØ¯Ø©'); return; }
    wordListData[cat] = [];
    await set(ref(db, `wordLists/${cat}`), []);
    document.getElementById('new-category').value = '';
    renderCategoryList();
    selectCategory(cat);
};

// â”€â”€ ANNOUNCEMENTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.setPriority = (p, btn) => {
    activePriority = p;
    document.querySelectorAll('[id^="pri-"]').forEach(b => b.style.fontWeight = '700');
    btn.style.fontWeight = '900'; btn.style.boxShadow = '0 0 10px currentColor';
};

window.sendAnnouncement = async () => {
    const text = document.getElementById('ann-text').value.trim();
    if (!text) { alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ù†Øµ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†'); return; }
    const duration = parseInt(document.getElementById('ann-duration').value);

    await push(ref(db, 'announcements'), {
        message:   text,
        priority:  activePriority,
        timestamp: Date.now(),
        expiresAt: Date.now() + duration
    });

    document.getElementById('ann-text').value = '';
    alert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†');
    loadAnnouncements();
};

function loadAnnouncements() {
    get(ref(db,'announcements')).then(snap => {
        const container = document.getElementById('active-announcements');
        if (!snap.exists()) { container.innerHTML='<p style="color:#555;font-size:12px;text-align:center;padding:20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</p>'; return; }
        const anns = Object.entries(snap.val())
            .filter(([,a]) => a.expiresAt > Date.now())
            .sort((a,b) => b[1].timestamp - a[1].timestamp);

        if (!anns.length) { container.innerHTML='<p style="color:#555;font-size:12px;text-align:center;padding:20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù†Ø´Ø·Ø©</p>'; return; }

        const priColor = {info:'#3b82f6', warning:'#f59e0b', critical:'#ef4444'};
        container.innerHTML = anns.map(([id,a]) => `
            <div style="padding:12px 16px;border-radius:10px;background:rgba(255,255,255,.04);
                border-right:4px solid ${priColor[a.priority]||'#3b82f6'};margin-bottom:10px;">
                <div style="display:flex;justify-content:space-between;align-items:start;gap:8px;">
                    <p style="font-size:13px;font-weight:700;flex:1;">${a.message}</p>
                    <button onclick="deleteAnn('${id}')" style="background:none;border:none;color:#ef4444;cursor:pointer;font-size:16px;flex-shrink:0;">âœ•</button>
                </div>
                <p style="font-size:10px;color:#555;margin-top:6px;">ÙŠÙ†ØªÙ‡ÙŠ: ${new Date(a.expiresAt).toLocaleDateString('ar-SA')}</p>
            </div>`).join('');
    });
}

window.deleteAnn = async (id) => {
    await remove(ref(db, `announcements/${id}`));
    loadAnnouncements();
};

// â”€â”€ ADMIN ACCESS MANAGEMENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.copyAdminCode = function() {
    const code = document.getElementById('current-admin-code').textContent;
    navigator.clipboard.writeText(code).then(() => {
        alert('âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ù…Ø²: ' + code);
    });
};

window.generateNewCode = async function() {
    if (!confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ\n\nØ¥Ù†Ø´Ø§Ø¡ Ø±Ù…Ø² Ø¬Ø¯ÙŠØ¯ Ø³ÙŠÙØ¨Ø·Ù„ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø­Ø§Ù„ÙŠ. ' +
        'Ø¬Ù…ÙŠØ¹ Ù…Ù† ÙŠÙ…Ù„ÙƒÙˆÙ† Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ù‚Ø¯ÙŠÙ… Ù„Ù† ÙŠØªÙ…ÙƒÙ†ÙˆØ§ Ù…Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ù„Ù„ÙˆØµÙˆÙ„.')) return;

    // Generate random code
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    let newCode = 'ADMIN';
    for (let i = 0; i < 6; i++) {
        newCode += chars[Math.floor(Math.random() * chars.length)];
    }

    try {
        // Save to Firebase (in a protected admin-only path)
        await set(ref(db, 'adminConfig/accessCode'), newCode);
        await set(ref(db, 'adminConfig/codeCreatedAt'), Date.now());
        await set(ref(db, 'adminConfig/codeCreatedBy'), auth.currentUser.uid);

        // Update display
        document.getElementById('current-admin-code').textContent = newCode;
        
        alert('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø±Ù…Ø² Ø¬Ø¯ÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­!\n\nØ§Ù„Ø±Ù…Ø² Ø§Ù„Ø¬Ø¯ÙŠØ¯: ' + newCode + 
            '\n\nÙ„Ø§ ØªÙ†Ø³Ù Ø­ÙØ¸Ù‡ ÙÙŠ Ù…ÙƒØ§Ù† Ø¢Ù…Ù†.');
    } catch (e) {
        alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ù…Ø²: ' + e.message);
    }
};

window.loadAdminsList = async function() {
    const container = document.getElementById('admins-list');
    container.innerHTML = '<p style="color:#555;font-size:12px;text-align:center;padding:20px;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>';

    try {
        const snap = await get(ref(db, 'players'));
        if (!snap.exists()) {
            container.innerHTML = '<p style="color:#555;font-size:12px;text-align:center;padding:20px;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³Ø¤ÙˆÙ„ÙˆÙ†</p>';
            return;
        }

        const players = snap.val();
        const admins = Object.entries(players)
            .filter(([uid, p]) => p.isAdmin === true)
            .sort((a, b) => (b[1].adminSince || 0) - (a[1].adminSince || 0));

        if (!admins.length) {
            container.innerHTML = '<p style="color:#555;font-size:12px;text-align:center;padding:20px;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³Ø¤ÙˆÙ„ÙˆÙ†</p>';
            return;
        }

        container.innerHTML = admins.map(([uid, p]) => {
            const since = p.adminSince ? new Date(p.adminSince).toLocaleDateString('ar-SA') : 'â€”';
            const isSelf = uid === auth.currentUser.uid;
            return `
                <div style="display:flex;align-items:center;justify-content:space-between;
                    padding:12px;border-bottom:1px solid rgba(255,255,255,.05);
                    ${isSelf ? 'background:rgba(0,242,255,.05);' : ''}">
                    <div style="display:flex;align-items:center;gap:12px;">
                        <div style="width:40px;height:40px;border-radius:50%;
                            background:linear-gradient(135deg,#00f2ff,#7c30ff);
                            display:flex;align-items:center;justify-content:center;">
                            <i class="fas fa-user-shield" style="color:white;font-size:16px;"></i>
                        </div>
                        <div>
                            <p style="font-size:13px;font-weight:700;">${p.username || 'Ù…Ø³Ø¤ÙˆÙ„'}
                                ${isSelf ? '<span style="color:#00f2ff;font-size:11px;margin-right:6px;">(Ø£Ù†Øª)</span>' : ''}</p>
                            <p style="font-size:11px;color:#666;">Ù…Ù†Ø°: ${since}</p>
                        </div>
                    </div>
                    ${!isSelf ? `<button onclick="revokeAdmin('${uid}', '${p.username || 'Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„'}')"
                        class="btn-danger" style="font-size:11px;padding:6px 12px;">
                        <i class="fas fa-user-times ml-1"></i> Ø¥Ù„ØºØ§Ø¡
                    </button>` : ''}
                </div>`;
        }).join('');

    } catch (e) {
        container.innerHTML = '<p style="color:#ef4444;font-size:12px;text-align:center;padding:20px;">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„</p>';
    }
};

window.revokeAdmin = async function(uid, username) {
    if (!confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ù„ØºØ§Ø¡ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ù…Ù† "${username}"ØŸ\n\nÙ„Ù† ÙŠØªÙ…ÙƒÙ† Ù…Ù† Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù„ÙˆØ­Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø¢Ù†.`)) return;

    try {
        await set(ref(db, `players/${uid}/isAdmin`), false);
        await set(ref(db, `players/${uid}/adminRevokedAt`), Date.now());
        alert('âœ… ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¨Ù†Ø¬Ø§Ø­');
        loadAdminsList();
    } catch (e) {
        alert('âŒ Ø®Ø·Ø£: ' + e.message);
    }
};

// Load admins list when admin access section is shown
const _origShowSection = window.showSection;
window.showSection = function(name) {
    _origShowSection(name);
    if (name === 'admin-access') {
        loadAdminsList();
        // Load current code from Firebase
        get(ref(db, 'adminConfig/accessCode')).then(snap => {
            if (snap.exists()) {
                document.getElementById('current-admin-code').textContent = snap.val();
            }
        });
    }
};

</script>
</body>
</html>